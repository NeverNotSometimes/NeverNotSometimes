<!DOCTYPE html>
<html>
<head>
  <title>Movies - Neverland</title>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9YG7C4CCC5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9YG7C4CCC5');
</script>
    <title>Neverland - Movies</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="stylesearch.css"
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7147610483646909"
     crossorigin="anonymous"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="searchbar/stylesearch.css">
  <style>
    body {
    overflow-y: scroll;
    }

    #movieContainer {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 10%;
    }
    .movie-item {
      margin: 20px;
      cursor: pointer;
      width: 11rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: transform 0.2s;
      transform: scale(1);
    }
    .movie-item:hover {
      transform: scale(1.08);
    }
    .movie-item img {
      width: 100%;
      height: auto;
      border-radius: 20px;
    }
    #loading {
      display: none; /* Initially hide loading animation */
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999; /* Ensure it's on top */
    }
    .lds-ring {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    .lds-ring div {
      box-sizing: border-box;
      display: block;
      position: absolute;
      width: 64px;
      height: 64px;
      margin: 8px;
      border: 8px solid #7f7bf2;
      border-radius: 50%;
      animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      border-color: #7f7bf2 transparent transparent transparent;
    }
    .lds-ring div:nth-child(1) {
      animation-delay: -0.45s;
    }
    .lds-ring div:nth-child(2) {
      animation-delay: -0.3s;
    }
    .lds-ring div:nth-child(3) {
      animation-delay: -0.15s;
    }
    @keyframes lds-ring {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Movies</h1>
    <button class="rounded grow" style="background-color: transparent; border: 3px solid rgb(70, 15, 143); font-size: 28px;">
    <a href="https://notsometimes.github.io">Home</a>
    </button>
    <br>
    <br>
    <p style="font-size: 28px;">"Wait- I can search for any movie ever made ever?"</p>
  <div>
    <form id="searchForm">
      <div class="search-container">
        <input id="searchbar" type="text" name="search" placeholder="Search for a movie..." class="search-input">
        <a href="#" class="search-btn" onclick="searchMovies()">
          <i class="fas fa-search"></i>
        </a>
        
      </div>
    </form>
  </div>
  <script src="https://kit.fontawesome.com/407915e39a.js" crossorigin="anonymous"></script>
  <div id="movieContainer"></div>
  <div id="loading" class="lds-ring"><div></div><div></div><div></div><div></div></div>

  <script>
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        searchMovies();
      });
    
    document.getElementById('searchbar').addEventListener('input', function(event) {
        searchMovies(); // Search movies as the user types
    });
    
    async function searchMovies() {
      try {
        const searchTerm = document.getElementById('searchbar').value.trim();
        if (searchTerm === '') {
          clearMovies();
          return;
        }
        const apiKey = 'c0aa80b5561bd96b6cd261ac6d57886c';
        const response = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${searchTerm}`);
        const data = await response.json();
        
        console.log(data); // Log the response for debugging
        
        if (data.results.length > 0) {
          displayMovies(data.results);
        } else {
          alert('No movies found!');
        }
      } catch (error) {
        console.error('Error fetching movies:', error);
        alert('An error occurred while fetching movies.');
      }
    }
    
    function displayMovies(movies) {
      const movieContainer = document.getElementById('movieContainer');
      movieContainer.innerHTML = ''; // Clear previous results
    
      movies.forEach(movie => {
        const movieItem = document.createElement('div');
        movieItem.classList.add('movie-item');
        
        const posterPath = movie.poster_path ? `https://image.tmdb.org/t/p/w200${movie.poster_path}` : 'https://via.placeholder.com/150';
        const img = document.createElement('img');
        img.src = posterPath;
        movieItem.appendChild(img);
    
        movieItem.addEventListener('click', () => redirectToTMDb(movie.id));
        movieContainer.appendChild(movieItem);
      });
    }
    
    function redirectToTMDb(movieId) {
      var movieUrl = `https://player.smashy.stream/movie/${movieId}`;
      var iframe = document.createElement("iframe");
      iframe.src = movieUrl;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      iframe.style.border = "0";
      iframe.style.position = "fixed";
      iframe.style.top = "0";
      iframe.style.left = "0";
      iframe.referrerpolicy = "no-referrer";
      iframe.allow = "fullscreen";
      
      // Display loading animation before appending iframe
      const loading = document.querySelector('.lds-ring');
      loading.style.display = 'block';
      
      // Append iframe after loading animation is displayed
      setTimeout(function() {
        document.getElementById("movieContainer").innerHTML = "";
        document.getElementById("movieContainer").appendChild(iframe);
        loading.style.display = 'none'; // Hide loading animation when iframe content is loaded
      }, 2000); // Adjust time delay as needed (2000 milliseconds = 2 seconds)
    }
  
    function clearMovies() {
      document.getElementById('movieContainer').innerHTML = '';
    }
    </script>
  <script src="searchbar/searchmovies.js"></script>
</body>
</html>